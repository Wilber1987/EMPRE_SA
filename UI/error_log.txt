[10/25/2024 2:08:49 PM] ERROR: Max retries reached. Operation failed.: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ThrowExceptionAndWarning(Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniSyncOverAsync()
   at System.Data.SqlClient.TdsParserStateObject.TryPrepareBuffer()
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[10/25/2024 2:08:49 PM] Transaction failed and connection restarted.: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ThrowExceptionAndWarning(Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniSyncOverAsync()
   at System.Data.SqlClient.TdsParserStateObject.TryPrepareBuffer()
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 10:20:22 PM] ERROR: Max retries reached. Operation failed.: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 10:20:22 PM] Transaction failed and connection restarted.: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 10:20:22 PM] ERROR: Save entity: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.ExcuteSqlQuery(String strQuery, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 231
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 51
   at CAPA_DATOS.EntityClass.Save() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\EntityStructure\EntityClass.cs:line 209
[1/9/2025 10:23:05 PM] ERROR: Max retries reached. Operation failed.: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 10:23:05 PM] Transaction failed and connection restarted.: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 10:23:05 PM] ERROR: Save entity: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.ExcuteSqlQuery(String strQuery, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 231
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 51
   at CAPA_DATOS.EntityClass.Save() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\EntityStructure\EntityClass.cs:line 209
[1/9/2025 10:23:07 PM] ERROR: Max retries reached. Operation failed.: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 10:23:07 PM] Transaction failed and connection restarted.: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 10:23:07 PM] ERROR: Save entity: Cannot insert the value NULL into column 'Serie', table 'EMPRE_SA.facturacion.Tbl_Factura'; column does not allow nulls. INSERT fails.
The statement has been terminated.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.ExcuteSqlQuery(String strQuery, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 231
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 51
   at CAPA_DATOS.EntityClass.Save() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\EntityStructure\EntityClass.cs:line 209
[1/9/2025 11:08:50 PM] ERROR: Max retries reached. Operation failed.: Must declare the scalar variable "@TotalDescuentoKDM_W_C_K".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 11:08:50 PM] Transaction failed and connection restarted.: Must declare the scalar variable "@TotalDescuentoKDM_W_C_K".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 11:08:50 PM] Transaction failed and connection restarted.: Must declare the scalar variable "@TotalDescuentoKDM_W_C_K".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.TraerDatosSQL(String queryString, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 351
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.BuildTable(EntityClass Inst, String& CondSQL, Boolean isSimpleFind) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 487
[1/9/2025 11:08:50 PM] ERROR: BuildTable 

 Tbl_Lotes 

  
 SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto),Cat_Almacenes = JSON_QUERY((SELECT  Id_Almacen,Descripcion,Estado,Id_Sucursal,Tbl_Lotes = (SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto),Cat_Almacenes = JSON_QUERY((SELECT  Id_Almacen,Descripcion,Estado,Id_Sucursal FROM facturacion.Cat_Almacenes as JCZ_D_T_K   WHERE   Id_Almacen = BDM_R_H_S.Id_Almacen  ORDER BY Id_Almacen DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = JSON_QUERY((SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as ENF_S_F_Q   WHERE   Id_Detalle_Compra = BDM_R_H_S.Id_Detalle_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as TCF_C_B_H   WHERE   Id_Producto = BDM_R_H_S.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Transaccion,Cantidad,Id_Lote,Tipo,Descripcion,Id_User FROM facturacion.Tbl_Transaccion as BZW_E_S_R   WHERE   Id_Lote = BDM_R_H_S.Id_Lote  ORDER BY Id_Transaccion DESC FOR JSON PATH) FROM facturacion.Tbl_Lotes as BDM_R_H_S   WHERE   Id_Almacen = LWT_W_E_I.Id_Almacen  ORDER BY Id_Lote DESC FOR JSON PATH) FROM facturacion.Cat_Almacenes as LWT_W_E_I   WHERE   Id_Almacen = FJX_H_I_W.Id_Almacen  ORDER BY Id_Almacen DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = JSON_QUERY((SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion,Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca,Cat_Marca = JSON_QUERY((SELECT  Id_Marca,Nombre,Descripcion,Estado FROM facturacion.Cat_Marca as CAU_M_L_T   WHERE   Id_Marca = XBC_S_O_N.Id_Marca  ORDER BY Id_Marca DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Categorias = JSON_QUERY((SELECT  Id_Categoria,Descripcion,Estado FROM facturacion.Cat_Categorias as ZSW_F_N_C   WHERE   Id_Categoria = XBC_S_O_N.Id_Categoria  ORDER BY Id_Categoria DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = (SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as DTS_Z_T_G   WHERE   Id_Producto = XBC_S_O_N.Id_Producto  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH),Detalle_Factura = (SELECT  Id_DetalleFactura,Id_Factura,Id_Producto,Cantidad,Precio_Venta,Iva,Total,Id_Lote,Descuento,Sub_Total,Monto_Descuento FROM facturacion.Detalle_Factura as CUK_M_Y_O   WHERE   Id_Producto = XBC_S_O_N.Id_Producto  ORDER BY Id_DetalleFactura DESC FOR JSON PATH) FROM facturacion.Cat_Producto as XBC_S_O_N   WHERE   Id_Producto = PYK_O_A_M.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Tbl_Compra = JSON_QUERY((SELECT  Id_Compra,Id_User,Id_Sucursal, Datos_Compra = JSON_QUERY(Datos_Compra),Id_Proveedor,Fecha,Tasa_Cambio,Moneda,Sub_Total,Iva,Total,Estado,Cat_Proveedor = JSON_QUERY((SELECT  Id_Proveedor,Nombre,Identificacion,Estado, Datos_Proveedor = JSON_QUERY(Datos_Proveedor) FROM facturacion.Cat_Proveedor as EFD_M_A_E   WHERE   Id_Proveedor = BOX_B_Q_R.Id_Proveedor  ORDER BY Id_Proveedor DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = (SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as NAF_O_X_S   WHERE   Id_Compra = BOX_B_Q_R.Id_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH) FROM facturacion.Tbl_Compra as BOX_B_Q_R   WHERE   Id_Compra = PYK_O_A_M.Id_Compra  ORDER BY Id_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto),Cat_Almacenes = JSON_QUERY((SELECT  Id_Almacen,Descripcion,Estado,Id_Sucursal FROM facturacion.Cat_Almacenes as AVE_P_T_W   WHERE   Id_Almacen = IDW_F_I_E.Id_Almacen  ORDER BY Id_Almacen DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = JSON_QUERY((SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as YRZ_K_T_D   WHERE   Id_Detalle_Compra = IDW_F_I_E.Id_Detalle_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as QJL_I_E_D   WHERE   Id_Producto = IDW_F_I_E.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Transaccion,Cantidad,Id_Lote,Tipo,Descripcion,Id_User FROM facturacion.Tbl_Transaccion as FSZ_V_B_L   WHERE   Id_Lote = IDW_F_I_E.Id_Lote  ORDER BY Id_Transaccion DESC FOR JSON PATH) FROM facturacion.Tbl_Lotes as IDW_F_I_E   WHERE   Id_Detalle_Compra = PYK_O_A_M.Id_Detalle_Compra  ORDER BY Id_Lote DESC FOR JSON PATH) FROM facturacion.Detalle_Compra as PYK_O_A_M   WHERE   Id_Detalle_Compra = FJX_H_I_W.Id_Detalle_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca,Cat_Marca = JSON_QUERY((SELECT  Id_Marca,Nombre,Descripcion,Estado,Cat_Producto = (SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as LFV_E_Y_N   WHERE   Id_Marca = ZID_S_J_E.Id_Marca  ORDER BY Id_Producto DESC FOR JSON PATH) FROM facturacion.Cat_Marca as ZID_S_J_E   WHERE   Id_Marca = YAJ_T_W_H.Id_Marca  ORDER BY Id_Marca DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Categorias = JSON_QUERY((SELECT  Id_Categoria,Descripcion,Estado,Cat_Producto = (SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as URF_F_Z_O   WHERE   Id_Categoria = MKN_R_V_Z.Id_Categoria  ORDER BY Id_Producto DESC FOR JSON PATH) FROM facturacion.Cat_Categorias as MKN_R_V_Z   WHERE   Id_Categoria = YAJ_T_W_H.Id_Categoria  ORDER BY Id_Categoria DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = (SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion,Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as HGD_E_R_I   WHERE   Id_Producto = GDB_K_S_Z.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Tbl_Compra = JSON_QUERY((SELECT  Id_Compra,Id_User,Id_Sucursal, Datos_Compra = JSON_QUERY(Datos_Compra),Id_Proveedor,Fecha,Tasa_Cambio,Moneda,Sub_Total,Iva,Total,Estado FROM facturacion.Tbl_Compra as ALM_D_L_H   WHERE   Id_Compra = GDB_K_S_Z.Id_Compra  ORDER BY Id_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto) FROM facturacion.Tbl_Lotes as IPK_L_J_S   WHERE   Id_Detalle_Compra = GDB_K_S_Z.Id_Detalle_Compra  ORDER BY Id_Lote DESC FOR JSON PATH) FROM facturacion.Detalle_Compra as GDB_K_S_Z   WHERE   Id_Producto = YAJ_T_W_H.Id_Producto  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH),Detalle_Factura = (SELECT  Id_DetalleFactura,Id_Factura,Id_Producto,Cantidad,Precio_Venta,Iva,Total,Id_Lote,Descuento,Sub_Total,Monto_Descuento,Tbl_Factura = JSON_QUERY((SELECT  Id_Factura,Tipo,Concepto,Forma_Pago,Direccion_Envio,Id_Cliente,Id_Sucursal,Id_User,Fecha,Fecha_Vencimiento,Observaciones,Id_Usuario,Estado,Sub_Total,TotalDescuento,Iva,Tasa_Cambio,Total FROM facturacion.Tbl_Factura as ROV_O_I_T   WHERE TotalDescuento = @TotalDescuentoKDM_W_C_K  AND   Id_Factura = UPT_S_W_Z.Id_Factura  ORDER BY Id_Factura DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Lote = JSON_QUERY((SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto) FROM facturacion.Tbl_Lotes as KHV_P_Y_J   WHERE   Id_Lote = UPT_S_W_Z.Id_Lote  ORDER BY Id_Lote DESC FOR JSON PATH,  ROOT('object')),'$.object[0]') FROM facturacion.Detalle_Factura as UPT_S_W_Z   WHERE   Id_Producto = YAJ_T_W_H.Id_Producto  ORDER BY Id_DetalleFactura DESC FOR JSON PATH) FROM facturacion.Cat_Producto as YAJ_T_W_H   WHERE   Id_Producto = FJX_H_I_W.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Transaccion,Cantidad,Id_Lote,Tipo,Descripcion,Id_User FROM facturacion.Tbl_Transaccion as NAM_L_N_I   WHERE   Id_Lote = FJX_H_I_W.Id_Lote  ORDER BY Id_Transaccion DESC FOR JSON PATH) FROM facturacion.Tbl_Lotes as FJX_H_I_W     ORDER BY Id_Lote DESC: Must declare the scalar variable "@TotalDescuentoKDM_W_C_K".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.TraerDatosSQL(String queryString, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 351
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.BuildTable(EntityClass Inst, String& CondSQL, Boolean isSimpleFind) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 487
[1/9/2025 11:09:32 PM] ERROR: Max retries reached. Operation failed.: Must declare the scalar variable "@TotalDescuentoYPP_V_R_B".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 11:09:32 PM] Transaction failed and connection restarted.: Must declare the scalar variable "@TotalDescuentoYPP_V_R_B".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/9/2025 11:09:32 PM] Transaction failed and connection restarted.: Must declare the scalar variable "@TotalDescuentoYPP_V_R_B".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.TraerDatosSQL(String queryString, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 351
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.BuildTable(EntityClass Inst, String& CondSQL, Boolean isSimpleFind) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 487
[1/9/2025 11:09:32 PM] ERROR: BuildTable 

 Tbl_Lotes 

  
 SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto),Cat_Almacenes = JSON_QUERY((SELECT  Id_Almacen,Descripcion,Estado,Id_Sucursal,Tbl_Lotes = (SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto),Cat_Almacenes = JSON_QUERY((SELECT  Id_Almacen,Descripcion,Estado,Id_Sucursal FROM facturacion.Cat_Almacenes as WVQ_L_H_T   WHERE   Id_Almacen = GPO_E_D_O.Id_Almacen  ORDER BY Id_Almacen DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = JSON_QUERY((SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as XFQ_Q_Q_A   WHERE   Id_Detalle_Compra = GPO_E_D_O.Id_Detalle_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as VIS_B_Q_P   WHERE   Id_Producto = GPO_E_D_O.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Transaccion,Cantidad,Id_Lote,Tipo,Descripcion,Id_User FROM facturacion.Tbl_Transaccion as IAB_R_X_J   WHERE   Id_Lote = GPO_E_D_O.Id_Lote  ORDER BY Id_Transaccion DESC FOR JSON PATH) FROM facturacion.Tbl_Lotes as GPO_E_D_O   WHERE   Id_Almacen = MCK_Q_W_P.Id_Almacen  ORDER BY Id_Lote DESC FOR JSON PATH) FROM facturacion.Cat_Almacenes as MCK_Q_W_P   WHERE   Id_Almacen = SMY_L_U_M.Id_Almacen  ORDER BY Id_Almacen DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = JSON_QUERY((SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion,Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca,Cat_Marca = JSON_QUERY((SELECT  Id_Marca,Nombre,Descripcion,Estado FROM facturacion.Cat_Marca as GES_P_D_U   WHERE   Id_Marca = EYL_W_U_R.Id_Marca  ORDER BY Id_Marca DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Categorias = JSON_QUERY((SELECT  Id_Categoria,Descripcion,Estado FROM facturacion.Cat_Categorias as CRR_K_W_M   WHERE   Id_Categoria = EYL_W_U_R.Id_Categoria  ORDER BY Id_Categoria DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = (SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as OLU_L_B_F   WHERE   Id_Producto = EYL_W_U_R.Id_Producto  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH),Detalle_Factura = (SELECT  Id_DetalleFactura,Id_Factura,Id_Producto,Cantidad,Precio_Venta,Iva,Total,Id_Lote,Descuento,Sub_Total,Monto_Descuento FROM facturacion.Detalle_Factura as DIH_Q_A_J   WHERE   Id_Producto = EYL_W_U_R.Id_Producto  ORDER BY Id_DetalleFactura DESC FOR JSON PATH) FROM facturacion.Cat_Producto as EYL_W_U_R   WHERE   Id_Producto = YLY_D_R_A.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Tbl_Compra = JSON_QUERY((SELECT  Id_Compra,Id_User,Id_Sucursal, Datos_Compra = JSON_QUERY(Datos_Compra),Id_Proveedor,Fecha,Tasa_Cambio,Moneda,Sub_Total,Iva,Total,Estado,Cat_Proveedor = JSON_QUERY((SELECT  Id_Proveedor,Nombre,Identificacion,Estado, Datos_Proveedor = JSON_QUERY(Datos_Proveedor) FROM facturacion.Cat_Proveedor as EUH_U_B_O   WHERE   Id_Proveedor = BOH_H_M_J.Id_Proveedor  ORDER BY Id_Proveedor DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = (SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as MIW_U_V_J   WHERE   Id_Compra = BOH_H_M_J.Id_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH) FROM facturacion.Tbl_Compra as BOH_H_M_J   WHERE   Id_Compra = YLY_D_R_A.Id_Compra  ORDER BY Id_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto),Cat_Almacenes = JSON_QUERY((SELECT  Id_Almacen,Descripcion,Estado,Id_Sucursal FROM facturacion.Cat_Almacenes as NJP_Y_Q_D   WHERE   Id_Almacen = UDR_N_M_W.Id_Almacen  ORDER BY Id_Almacen DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = JSON_QUERY((SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion FROM facturacion.Detalle_Compra as NMZ_V_B_K   WHERE   Id_Detalle_Compra = UDR_N_M_W.Id_Detalle_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as WVD_L_H_S   WHERE   Id_Producto = UDR_N_M_W.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Transaccion,Cantidad,Id_Lote,Tipo,Descripcion,Id_User FROM facturacion.Tbl_Transaccion as ILP_R_O_P   WHERE   Id_Lote = UDR_N_M_W.Id_Lote  ORDER BY Id_Transaccion DESC FOR JSON PATH) FROM facturacion.Tbl_Lotes as UDR_N_M_W   WHERE   Id_Detalle_Compra = YLY_D_R_A.Id_Detalle_Compra  ORDER BY Id_Lote DESC FOR JSON PATH) FROM facturacion.Detalle_Compra as YLY_D_R_A   WHERE   Id_Detalle_Compra = SMY_L_U_M.Id_Detalle_Compra  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca,Cat_Marca = JSON_QUERY((SELECT  Id_Marca,Nombre,Descripcion,Estado,Cat_Producto = (SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as ROG_F_F_R   WHERE   Id_Marca = FRN_B_T_J.Id_Marca  ORDER BY Id_Producto DESC FOR JSON PATH) FROM facturacion.Cat_Marca as FRN_B_T_J   WHERE   Id_Marca = ZVT_X_H_Q.Id_Marca  ORDER BY Id_Marca DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Cat_Categorias = JSON_QUERY((SELECT  Id_Categoria,Descripcion,Estado,Cat_Producto = (SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as MCG_Y_U_M   WHERE   Id_Categoria = FMP_G_W_B.Id_Categoria  ORDER BY Id_Producto DESC FOR JSON PATH) FROM facturacion.Cat_Categorias as FMP_G_W_B   WHERE   Id_Categoria = ZVT_X_H_Q.Id_Categoria  ORDER BY Id_Categoria DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Detalle_Compra = (SELECT  Id_Detalle_Compra,Id_Compra,Id_Producto,Cantidad,Precio_Unitario,SubTotal,Iva,Total,Presentacion,Cat_Producto = JSON_QUERY((SELECT  Id_Producto,Descripcion,Id_Categoria,Id_Marca FROM facturacion.Cat_Producto as XHR_D_D_A   WHERE   Id_Producto = BEP_E_V_B.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Tbl_Compra = JSON_QUERY((SELECT  Id_Compra,Id_User,Id_Sucursal, Datos_Compra = JSON_QUERY(Datos_Compra),Id_Proveedor,Fecha,Tasa_Cambio,Moneda,Sub_Total,Iva,Total,Estado FROM facturacion.Tbl_Compra as JFI_E_B_H   WHERE   Id_Compra = BEP_E_V_B.Id_Compra  ORDER BY Id_Compra DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto) FROM facturacion.Tbl_Lotes as IIB_Q_U_V   WHERE   Id_Detalle_Compra = BEP_E_V_B.Id_Detalle_Compra  ORDER BY Id_Lote DESC FOR JSON PATH) FROM facturacion.Detalle_Compra as BEP_E_V_B   WHERE   Id_Producto = ZVT_X_H_Q.Id_Producto  ORDER BY Id_Detalle_Compra DESC FOR JSON PATH),Detalle_Factura = (SELECT  Id_DetalleFactura,Id_Factura,Id_Producto,Cantidad,Precio_Venta,Iva,Total,Id_Lote,Descuento,Sub_Total,Monto_Descuento,Tbl_Factura = JSON_QUERY((SELECT  Id_Factura,Tipo,Concepto,Forma_Pago,Direccion_Envio,Id_Cliente,Id_Sucursal,Id_User,Fecha,Fecha_Vencimiento,Observaciones,Id_Usuario,Estado,Sub_Total,TotalDescuento,Iva,Tasa_Cambio,Total FROM facturacion.Tbl_Factura as TMM_K_B_A   WHERE TotalDescuento = @TotalDescuentoYPP_V_R_B  AND   Id_Factura = HGL_N_K_L.Id_Factura  ORDER BY Id_Factura DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),Lote = JSON_QUERY((SELECT  Id_Lote,Id_Producto,Precio_Venta,Precio_Compra,Cantidad_Inicial,Cantidad_Existente,Id_Sucursal,Id_User,Fecha_Ingreso,Id_Almacen,Lote,Id_Detalle_Compra,Detalles, Datos_Producto = JSON_QUERY(Datos_Producto) FROM facturacion.Tbl_Lotes as HTJ_E_M_W   WHERE   Id_Lote = HGL_N_K_L.Id_Lote  ORDER BY Id_Lote DESC FOR JSON PATH,  ROOT('object')),'$.object[0]') FROM facturacion.Detalle_Factura as HGL_N_K_L   WHERE   Id_Producto = ZVT_X_H_Q.Id_Producto  ORDER BY Id_DetalleFactura DESC FOR JSON PATH) FROM facturacion.Cat_Producto as ZVT_X_H_Q   WHERE   Id_Producto = SMY_L_U_M.Id_Producto  ORDER BY Id_Producto DESC FOR JSON PATH,  ROOT('object')),'$.object[0]'),lotes = (SELECT  Id_Transaccion,Cantidad,Id_Lote,Tipo,Descripcion,Id_User FROM facturacion.Tbl_Transaccion as MQT_I_F_K   WHERE   Id_Lote = SMY_L_U_M.Id_Lote  ORDER BY Id_Transaccion DESC FOR JSON PATH) FROM facturacion.Tbl_Lotes as SMY_L_U_M     ORDER BY Id_Lote DESC: Must declare the scalar variable "@TotalDescuentoYPP_V_R_B".
Incorrect syntax near the keyword 'ORDER'.
Incorrect syntax near the keyword 'ORDER'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite, String method)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.TraerDatosSQL(String queryString, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 351
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.BuildTable(EntityClass Inst, String& CondSQL, Boolean isSimpleFind) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 487
[1/29/2025 7:13:06 PM] ERROR: Max retries reached. Operation failed.: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/29/2025 7:13:06 PM] Transaction failed and connection restarted.: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/29/2025 7:13:06 PM] ERROR: Save entity: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.ExcuteSqlQuery(String strQuery, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 231
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 51
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertRelationatedObject(Object foreignKeyValue, EntityClass entity, PropertyInfo foreignKeyColumn, Boolean isUpdate) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 219
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 125
   at CAPA_DATOS.EntityClass.Save() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\EntityStructure\EntityClass.cs:line 209
[1/29/2025 7:13:06 PM] Error al guardar la factura: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.ExcuteSqlQuery(String strQuery, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 231
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 51
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertRelationatedObject(Object foreignKeyValue, EntityClass entity, PropertyInfo foreignKeyColumn, Boolean isUpdate) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 219
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 125
   at CAPA_DATOS.EntityClass.Save() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\EntityStructure\EntityClass.cs:line 209
   at Model.ContractServices.DoSaveContract(String seasonKey) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Empresa\Services\Contracts\ContractServices.cs:line 140
   at UI.CAPA_NEGOCIO.Facturacion.Operations.FacturacionServices.GenerarContratoMensual(String Identity, Tbl_Factura factura) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Facturacion\Operations\FacturacionServices.cs:line 244
   at UI.CAPA_NEGOCIO.Facturacion.Operations.FacturacionServices.DoSaveFactura(String Identity, Tbl_Factura factura) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Facturacion\Operations\FacturacionServices.cs:line 153
   at UI.CAPA_NEGOCIO.Facturacion.Operations.FacturacionServices.SaveFactura(String Identity, Tbl_Factura factura) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Facturacion\Operations\FacturacionServices.cs:line 20
[1/29/2025 7:15:00 PM] ERROR: Max retries reached. Operation failed.: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/29/2025 7:15:00 PM] Transaction failed and connection restarted.: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[1/29/2025 7:15:00 PM] ERROR: Save entity: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.ExcuteSqlQuery(String strQuery, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 231
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 51
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertRelationatedObject(Object foreignKeyValue, EntityClass entity, PropertyInfo foreignKeyColumn, Boolean isUpdate) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 219
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 125
   at CAPA_DATOS.EntityClass.Save() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\EntityStructure\EntityClass.cs:line 209
[1/29/2025 7:15:00 PM] Error al guardar la factura: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.: Cannot insert explicit value for identity column in table 'Tbl_Cuotas' when IDENTITY_INSERT is set to OFF.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteScalar()
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass23_0.<ExcuteSqlQuery>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 236
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
   at CAPA_DATOS.GDatosAbstract.ExcuteSqlQuery(String strQuery, List`1 parameters) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 231
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 51
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertRelationatedObject(Object foreignKeyValue, EntityClass entity, PropertyInfo foreignKeyColumn, Boolean isUpdate) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 219
   at CAPA_DATOS.BDCore.Abstracts.WDataMapper.InsertObject(EntityClass entity) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\DataMapper.cs:line 125
   at CAPA_DATOS.EntityClass.Save() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\EntityStructure\EntityClass.cs:line 209
   at Model.ContractServices.DoSaveContract(String seasonKey) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Empresa\Services\Contracts\ContractServices.cs:line 140
   at UI.CAPA_NEGOCIO.Facturacion.Operations.FacturacionServices.GenerarContratoMensual(String Identity, Tbl_Factura factura) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Facturacion\Operations\FacturacionServices.cs:line 244
   at UI.CAPA_NEGOCIO.Facturacion.Operations.FacturacionServices.DoSaveFactura(String Identity, Tbl_Factura factura) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Facturacion\Operations\FacturacionServices.cs:line 153
   at UI.CAPA_NEGOCIO.Facturacion.Operations.FacturacionServices.SaveFactura(String Identity, Tbl_Factura factura) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\UI\CAPA_NEGOCIO\Facturacion\Operations\FacturacionServices.cs:line 20
[2/19/2025 9:04:09 AM] ERROR: Max retries reached. Operation failed.: A transport-level error has occurred when receiving results from the server. (provider: Session Provider, error: 19 - Physical connection is not usable)
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ThrowExceptionAndWarning(Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniSyncOverAsync()
   at System.Data.SqlClient.TdsParserStateObject.TryPrepareBuffer()
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[2/19/2025 9:04:09 AM] Transaction failed and connection restarted.: A transport-level error has occurred when receiving results from the server. (provider: Session Provider, error: 19 - Physical connection is not usable)
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ThrowExceptionAndWarning(Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)
   at System.Data.SqlClient.TdsParserStateObject.ReadSniSyncOverAsync()
   at System.Data.SqlClient.TdsParserStateObject.TryPrepareBuffer()
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[2/19/2025 4:07:44 PM] ERROR: Max retries reached. Operation failed.: Cannot open server 'empresociedadanonima' requested by the login. Client with IP address '152.231.33.115' is not allowed to access the server.  To enable access, use the Azure Management Portal or run sp_set_firewall_rule on the master database to create a firewall rule for this IP address or address range.  It may take up to five minutes for this change to take effect.
   at System.Data.ProviderBase.DbConnectionPool.CheckPoolBlockingPeriod(Exception e)
   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.SqlClient.SqlConnection.Open()
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
[2/19/2025 4:07:44 PM] Transaction failed and connection restarted.: Cannot open server 'empresociedadanonima' requested by the login. Client with IP address '152.231.33.115' is not allowed to access the server.  To enable access, use the Azure Management Portal or run sp_set_firewall_rule on the master database to create a firewall rule for this IP address or address range.  It may take up to five minutes for this change to take effect.
   at System.Data.ProviderBase.DbConnectionPool.CheckPoolBlockingPeriod(Exception e)
   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at System.Data.SqlClient.SqlConnection.Open()
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at CAPA_DATOS.GDatosAbstract.<>c__DisplayClass30_0.<TraerDatosSQL>b__0() in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 361
   at CAPA_DATOS.GDatosAbstract.ExecuteWithRetry(Func`1 operation, Int32 maxRetries) in C:\Users\wilbe\repos\NETCORE\EMPRE_SA\CAPA_DATOS\BDCore\Abstracts\GDatosAbstract.cs:line 299
